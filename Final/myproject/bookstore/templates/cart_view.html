{% extends "base.html" %}
{% load custom_filters %}

{% block content %}
<style>
/* (‡∏Ñ‡∏á css ‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏≥‡πÑ‡∏ß‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢) */
</style>

<div class="container">
    <h1 class="cart-title">üõí ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h1>


    <table class="table table-bordered text-center" id="cart-table">
        <thead class="thead-light">
            <tr>
                <th>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                <th>‡∏£‡∏≤‡∏Ñ‡∏≤</th>
                <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
                <th>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°</th>
                <th>‡∏•‡∏ö</th>
            </tr>
        </thead>
        <tbody>
            {% if all_book %}
                {% for book in all_book %}
                <tr>
                    <td>{{ book.name }}</td>
                    <td>‡∏ø{{ book.price|floatformat:2 }}</td>
                    <td>{{ book.quantity }}</td>
                    <td>‡∏ø{{ book.total_price|floatformat:2 }}</td>
                    <td><button class="btn btn-danger btn-sm delete-btn">‡∏•‡∏ö</button></td>
                </tr>
                {% endfor %}
            {% else %}
                <tr>
                    <td colspan="5">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</td>
                </tr>
            {% endif %}
        </tbody>
        <tfoot>
            <tr>
                <td colspan="3" class="text-right"><strong>‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</strong></td>
                <td colspan="2"><strong id="total-price">‡∏ø{{ total_price|floatformat:2 }}</strong></td>
            </tr>
        </tfoot>
    </table>

    {% if all_book %}
    <div class="total-price">
        ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: {{ total_price|floatformat:2 }} ‡∏ö‡∏≤‡∏ó
    </div>
    <a href="{% url 'checkout' %}" class="checkout-btn">üõçÔ∏è ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</a>
    {% endif %}
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const table = document.getElementById('cart-table');
    const addItemBtn = document.getElementById('add-item');

    table.addEventListener('click', function (e) {
        if (e.target.classList.contains('delete-btn')) {
            const row = e.target.closest('tr');
            row.remove();
            updateTotal();
        }
    });

    addItemBtn.addEventListener('click', function () {
        const tbody = table.querySelector('tbody');
        const newRow = document.createElement('tr');
        newRow.innerHTML = `
            <td>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà</td>
            <td>‡∏ø20 .00</td>
            <td>1</td>
            <td>‡∏ø20.00</td>
            <td><button class="btn btn-danger btn-sm delete-btn">‡∏•‡∏ö</button></td>
        `;
        tbody.appendChild(newRow);
        updateTotal();
    });

    function updateTotal() {
        let total = 0;
        const rows = table.querySelectorAll('tbody tr');
        rows.forEach(row => {
            const totalCell = row.cells[3];
            if (totalCell) {
                const priceText = totalCell.innerText.replace('‡∏ø', '').replace(',', '');
                const price = parseFloat(priceText);
                if (!isNaN(price)) {
                    total += price;
                }
            }
        });
        document.getElementById('total-price').innerText = `‡∏ø${total.toFixed(2)}`;
    }
});
</script>

{% endblock %}
